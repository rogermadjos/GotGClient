<!DOCTYPE HTML>
<html>
	<head>
		<title>Game of the Generals</title>
		<script type="text/javascript" src="cordova.js"></script>
		<script type="text/javascript" src="jquery-1.10.2.min.js"></script>
		<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
		<script type="text/javascript">
		var pieceSize;
		var pieceState = new Array();
		var pieces = 
		[
				"spy.png",
				"5-star.png",
				"4-star.png",
				"3-star.png",
				"2-star.png",
				"1-star.png",
				"colonel.png",
				"leutenantcolonel.png",
				"major.png",
				"captain.png",
				"firstleutenant.png",
				"secondleutenant.png",
				"sergeant.png",
				"private.png",
				"flag.png"
		];
		
		function setTilePiece(coor,rank) {
			$("#"+coor).html("");
			var html = "<div class='piece' style='height:"+
				pieceSize+"px'><image src='images/"+pieces[rank]+"' width='"+
				pieceSize+"' height='"+pieceSize+"'/>"+
				"<input type='hidden' name='coordinate' value='"+coor+"'/>"+
				"<input type='hidden' name='rank' value='"+rank+"'/></div>";
 			$("#"+coor).html(html);
		}

		function boardStartConfig() {
			//random
			var charset = "abcdefghi";
			var coor = new Array();
			var index = 0;
			for(var x=0;x<9;x++) {
				for(var y=1;y<=3;y++) {
					var c = charset.charAt(x)+""+y;
					coor[index++] = c;
				}
			}
			var sel = new Array();
			var front = 0;
			var count = 0;
			while(count < 21) {
				var index = Math.floor(Math.random()*coor.length);
				var str = coor.splice(index,1)+"";
				if(str.charAt(1) == '3') {
					front++;
					if(front >= 4) {
						continue;
					}
				}
				sel[count] = str;
				count++;
			}
			setTilePiece(sel[0],0);
			setTilePiece(sel[1],0);
			for(var i=2;i<14;i++) {
				setTilePiece(sel[i],i-1);
			}
			for(var i=14;i<20;i++) {
				setTilePiece(sel[i],13);
			}
			setTilePiece(sel[20],14);
		}
		
		function initGameBoard() {
			var board = $("#board");
			board.css("height",(window.innerWidth * 8/9) + "px");
 			var html = "";
 			var charSet = "abcdefghi";
 			for(var y=8;y>=1;y--) {
 				html += "<tr class='row'>";
 				for(var x=0;x<9;x++) {
 					html += "<td class='tile' id='"+charSet.charAt(x)+y+"'>";
 				}
 				html += "</tr>";
 			}
 			board.html(html);
 			$(".row").css("height",(window.innerWidth / 9) + "px");
 			boardStartConfig();
 			$(".tile").on("click",function() {
 				if($(this).html() == "")
 					return;
 				var coor = $(this).find("input[name='coordinate']").attr("value");
 				var rank = $(this).find("input[name='rank']").attr("value");
 				$(".highlight").remove();
 				$(this).append("<div class='highlight' style='margin-top:-"+pieceSize+"px;height:"+pieceSize+"px'><image src='images/highlight.png' width='"+pieceSize+"' height='"+pieceSize+"'/></div>");
 				console.log(coor+" "+rank);
 			});
		}
		
		function onDeviceReady() {
			pieceSize = window.innerWidth/9 - 2;
			initGameBoard();
		}
		
		function init() {
			document.addEventListener("deviceready", onDeviceReady, false);
		}
		</script>
		<style media="screen" type="text/css">
		body {
			margin: 0px;
			padding: 0px;
			background: white;
		}
		button, td {
			-webkit-tap-highlight-color: rgba(255, 255, 255, 0) !important;
		}
		.tile {
			border: 0px;
			background: black;
			padding: 0px;
			margin: 0px;
			overflow: hidden;
		}
		#board {
			width: 100%;
			background: green;
			table-layout: fixed;
		}
		.piece {
			padding: 0px;
			margin: 0px;
			overflow: hidden;
		}
		.row {
			padding: 0px;
		}
		</style>
	</head>
	<body onLoad="init()">
		<div id='gamewindow'>
			<table id='board'>
			</table>
		</div>
	</body>
</html>